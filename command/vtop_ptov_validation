# This command file is used to test the function of vtop/ptov.
# If a address A is vtop then ptov, then get a returned address B,
# the content of A and B must be the same, otherwise crash meets an
# internal error.

COMMAND_START
@ sym -l | grep -e '(T)\\|(t)' | sed "20p;d" | awk '{print $1}' > {{virtual_addr1}}
@ vtop {{virtual_addr1}} | sed -n 2p | awk '{print $2}' > {{physical_addr}}
@ ptov {{physical_addr}} | sed -n 2p | awk '{print $1}' > {{virtual_addr2}}
@ rd {{virtual_addr1}} 32 | awk '{print $2,$3}' > {{content1}}
@ rd {{virtual_addr2}} 32 | awk '{print $2,$3}' > {{content2}}
@ ! echo {{content1}} | md5sum | cut -f1 -d" " > {{content_md5_1}}
@ ! echo {{content2}} | md5sum | cut -f1 -d" " > {{content_md5_2}}
@ echo "Content1 md5sum: {{content_md5_1}}"
@ echo "Content2 md5sum: {{content_md5_2}}"
@ ! [[ "{{content_md5_1}}"=="{{content_md5_2}}" ]] && echo "Content compare GOOD" || echo "Content compare BAD"
q
COMMAND_END